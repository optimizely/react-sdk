language: node_js
os: linux
node_js:
  - 10
install: yarn
script: yarn test
addons:
  srcclr: true

# Integration tests need to run first to reset the PR build status to pending
stages:
  - 'Lint markdown files'
  - 'Test'

jobs:
  include:
    - stage: 'Lint markdown files'
      os: linux
      language: ruby
      rvm: 2.4.1
      install: gem install awesome_bot
      before_script: skip
      script:
        - find . -type f -name '*.md' -exec awesome_bot {} \;

    - stage: 'Lint markdown files'
      language: generic
      os: linux
      before_install: skip
      install:
        - npm i -g markdown-spellcheck
      before_script:
        - wget --quiet https://raw.githubusercontent.com/optimizely/mdspell-config/master/.spelling
      script:
        - mdspell -a -n -r --en-us '**/*.md'
      after_success: skip
